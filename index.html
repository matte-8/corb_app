<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home - U.S. Corbiolo C5</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#660000">
  <link rel="icon" href="img/logo2.png" type="image/png">
</head>
<body>
  <header class="header">
    <img src="img/logo.png" alt="Logo" class="logo">
    <h1 class="page-title">Home</h1>
    <div class="menu-icon" onclick="toggleMenu()">â˜°</div>
  </header>

  <div class="popup-menu" id="popupMenu">
    <a href="index.html">ğŸ  Home</a>
    <a href="news.html">ğŸ—ï¸ News <span id="badgeNews" class="badge-news" style="display:none">NEW</span></a>
    <a href="squadra.html">ğŸ‘¥ Squadra</a>
    <a href="partite.html">ğŸ—•ï¸ Partite</a>
    <a href="sponsor.html">ğŸ’° Sponsor</a>
  </div>

  <!-- Sezione principale -->
  <div class="box-row">
    <div class="grid-3">
      <a href="news.html" class="card">
        <div class="card-icon">ğŸ—ï¸</div>
        News <span id="badgeNewsCard" class="badge-news" style="display:none">NEW</span>
      </a>
      <a href="squadra.html" class="card">
        <div class="card-icon">ğŸ‘¥</div>
        Squadra
      </a>
      <a href="sponsor.html" class="card">
        <div class="card-icon">ğŸ’°</div>
        Sponsor
      </a>
    </div>
  </div>

  <!-- Prossima partita + risultato -->
  <div class="box-row" id="homeData">
    <!-- VerrÃ  popolato dinamicamente -->
  </div>

  <!-- Footer -->
  <div class="footer">
    <div class="sponsor-title">Sponsor</div>
    <div class="carousel-wrapper">
      <div class="carousel-content">
        <img src="img/sponsor1.png" alt="Sponsor 1">
        <img src="img/sponsor2.png" alt="Sponsor 2">
        <img src="img/sponsor3.png" alt="Sponsor 3">
        <img src="img/sponsor1.png" alt="Sponsor 1 clone">
        <img src="img/sponsor2.png" alt="Sponsor 2 clone">
        <img src="img/sponsor3.png" alt="Sponsor 3 clone">
      </div>
    </div>
  </div>

  <script>
    const URL = "https://script.google.com/macros/s/AKfycbx1Lh2iRYAlC6JgYpGYXn9m4yv0wlSXpJedAAzzaBjksiv85Cw8pvHFj0gTv74amziuvg/exec";

    function toggleMenu() {
      const menu = document.getElementById("popupMenu");
      menu.style.display = menu.style.display === "flex" ? "none" : "flex";
    }

    function buildHomeSection(data) {
      let latestMatch = data.partite.find(p => p.risultato);
      let upcomingMatch = data.partite.find(p => !p.risultato);

      const risultatoHTML = latestMatch ? `
        <div class="grid-custom">
          <div class="card">
            <div class="card-icon">ğŸ—“ï¸</div>
            Prossima Partita
            <p>${upcomingMatch.data} - ${upcomingMatch.ora}</p>
            <p>${upcomingMatch.casa} vs ${upcomingMatch.fuori}</p>
          </div>
          <div class="card result-large">
            <div class="result-row">
              <img src="img/${latestMatch.logocasa}" class="team-logo">
              <div class="result-score">${latestMatch.risultato}</div>
              <img src="img/${latestMatch.logoavv}" class="team-logo">
            </div>
            <div class="result-names">
              <span class="team-name">${latestMatch.casa}</span>
              <span class="team-name">${latestMatch.fuori}</span>
            </div>
          </div>
        </div>` : "";

      const html = `
        ${risultatoHTML}
        <div class="section">
          <div class="section-title-icon">ğŸ“° Ultima Notizia</div>
          <p>${data.news[0].titolo}</p>
        </div>
      `;

      document.getElementById("homeData").innerHTML = html;
    }

    // Caching con localStorage
    async function loadHomeData() {
      const cache = localStorage.getItem("homeData");
      if (cache) {
        const parsed = JSON.parse(cache);
        buildHomeSection(parsed);
      }

      try {
        const res = await fetch(URL);
        const data = await res.json();
        localStorage.setItem("homeData", JSON.stringify(data));
        buildHomeSection(data);

        // Badge NEW se c'Ã¨ una news nuova
        const hasNew = data.news.some(n => n.nuova === "TRUE");
        if (hasNew) {
          document.getElementById("badgeNews").style.display = "inline-block";
          document.getElementById("badgeNewsCard").style.display = "inline-block";
        }
      } catch (e) {
        console.error("Errore nel caricamento", e);
      }
    }

    loadHomeData();
  </script>
</body>
</html>
