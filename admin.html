<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin - U.S. Corbiolo C5</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    body { padding-top: 80px; }
    #adminContent, .section-content { display: none; }
    .toggle-btn {
      width:100%; padding:12px; background:#801e1e; color:white;
      font-size:18px; border:none; text-align:left; cursor:pointer; margin-bottom:4px;
    }
    .section {
      background:#801e1e; padding:14px; border-radius:8px; margin-bottom:12px;
    }
    .section input, .section textarea, .section select {
      width:100%; margin-bottom:8px; padding:10px; border-radius:6px; border:none;
    }
    .section button {
      padding:10px 16px; margin-top:8px; border:none; border-radius:6px;
      background:#ffcc00; color:#000; font-weight:bold; cursor:pointer;
    }

    .item-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 16px;
      background: #5a0d0d;
      padding: 10px;
      border-radius: 8px;
    }
    .item-row input, .item-row textarea {
      padding: 8px;
      border-radius: 6px;
      border: none;
      width: 100%;
    }
    .btn-group {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 6px;
    }
    .btn-delete {
      background: #ff4444; color: white;
    }
    .btn-save {
      background: #33cc33; color: white;
    }
  </style>
</head>
<body>
  <div id="passwordPrompt">
    <h2>Accesso Admin</h2>
    <input type="password" id="adminPass" placeholder="Inserisci password" />
    <button onclick="checkPassword()">Accedi</button>
  </div>

  <div id="adminContent">
    <header class="header">
      <img src="img/logo.png" alt="Logo" class="logo" />
      <h1 class="page-title">Admin</h1>
      <div class="menu-icon" onclick="toggleMenu()">☰</div>
    </header>

    <div class="popup-menu" id="popupMenu">
      <a href="index.html">🏠 Home</a>
      <a href="news.html">🗞️ News</a>
      <a href="squadra.html">👥 Squadra</a>
      <a href="partite.html">⚽️ Partite</a>
      <a href="calendario.html">🗓 Calendario</a>
      <a href="sponsor.html">💰 Sponsor</a>
      <a href="admin.html">🔐 Admin</a>
    </div>

    <button class="toggle-btn" onclick="toggleSection('insertContent')">➕ Inserimento Contenuti</button>
    <div id="insertContent" class="section-content">
      <div class="section">
        <h3>🗞️ Nuova News</h3>
        <input id="i_news_title" placeholder="Titolo" />
        <textarea id="i_news_text" placeholder="Contenuto"></textarea>
        <button onclick="insertItem('news')">Salva</button>
      </div>
      <div class="section">
        <h3>👤 Nuovo Giocatore</h3>
        <input id="i_player_name" placeholder="Nome" />
        <input id="i_player_role" placeholder="Ruolo" />
        <input id="i_player_number" placeholder="Numero" />
        <input id="i_player_photo" placeholder="Foto (es: player1.png)" />
        <button onclick="insertItem('giocatori')">Salva</button>
      </div>
      <div class="section">
        <h3>💼 Nuovo Sponsor</h3>
        <input id="i_sponsor_name" placeholder="Nome" />
        <input id="i_sponsor_logo" placeholder="Logo (es: sponsor1.png)" />
        <input id="i_sponsor_link" placeholder="Link" />
        <button onclick="insertItem('sponsor')">Salva</button>
      </div>
      <div class="section">
        <h3>⚽ Nuova Partita</h3>
        <input type="date" id="i_match_date" />
        <input type="time" id="i_match_time" />
        <input id="i_match_home" placeholder="Casa" />
        <input id="i_match_home_logo" placeholder="Logo Casa" />
        <input id="i_match_away" placeholder="Fuori" />
        <input id="i_match_away_logo" placeholder="Logo Fuori" />
        <input id="i_match_score" placeholder="Risultato (es: 2-1)" />
        <button onclick="insertItem('partite')">Salva</button>
      </div>
      <div class="section">
        <h3>📅 Nuovo Evento Calendario</h3>
        <input type="date" id="i_cal_date" />
        <input id="i_cal_opponent" placeholder="Avversario" />
        <select id="i_cal_home">
          <option value="casa">Casa</option>
          <option value="fuori">Fuori</option>
        </select>
        <button onclick="insertItem('calendario')">Salva</button>
      </div>

      <div class="section">
        <h3>📥 Aggiorna da Google Sheets</h3>
        <button onclick="aggiornaDaGoogle()">Aggiorna Dati</button>
        <p id="updateStatus" style="margin-top: 8px;"></p>
      </div>
    </div>

    <button class="toggle-btn" onclick="toggleSection('editContent')">✏️ Modifica/Elimina Contenuti</button>
    <div id="editContent" class="section-content">
      <div id="editLists"></div>
    </div>
  </div>

  <script>
    function toggleMenu() {
      const m = document.getElementById("popupMenu");
      m.style.display = m.style.display === "flex" ? "none" : "flex";
    }

    function checkPassword(){
      if(document.getElementById("adminPass").value==='corb25'){
        document.getElementById("passwordPrompt").style.display='none';
        document.getElementById("adminContent").style.display='block';
        loadEditLists();
      } else alert("Password errata");
    }

    function toggleSection(id){
      const el = document.getElementById(id);
      el.style.display = el.style.display==='block'?'none':'block';
    }

    function getData(key){
      try{ return JSON.parse(localStorage.getItem(key))||[] }catch{ return []; }
    }

    function saveData(key, arr){
      localStorage.setItem(key, JSON.stringify(arr));
    }

    function insertItem(type){
      const m = {
        news:["i_news_title","i_news_text"],
        giocatori:["i_player_name","i_player_role","i_player_number","i_player_photo"],
        sponsor:["i_sponsor_name","i_sponsor_logo","i_sponsor_link"],
        partite:["i_match_date","i_match_time","i_match_home","i_match_home_logo","i_match_away","i_match_away_logo","i_match_score"],
        calendario:["i_cal_date","i_cal_opponent","i_cal_home"]
      };
      const ids = m[type];
      const obj = {};
      ids.forEach(id=> obj[id.split('_').slice(1).join('_')] = document.getElementById(id).value.trim());
      const arr = getData(type);
      arr.unshift(obj);
      saveData(type, arr);
      alert(`${type} inserito`);
      ids.forEach(id=>document.getElementById(id).value="");
      loadEditLists();
    }

    function loadEditLists(){
      const container = document.getElementById("editLists");
      container.innerHTML="";
      ["news","giocatori","sponsor","partite","calendario"].forEach(type=>{
        const arr = getData(type);
        const sec = document.createElement("div");
        sec.className="section";
        sec.innerHTML=`<h3>${type.toUpperCase()}</h3>`;
        arr.forEach((it,i)=>{
          const row = document.createElement("div");
          row.className="item-row";
          for (let key in it) {
            const input = document.createElement("input");
            input.value = it[key];
            input.oninput = e => it[key] = e.target.value;
            row.appendChild(input);
          }
          const btnGroup = document.createElement("div");
          btnGroup.className = "btn-group";

          const delBtn = document.createElement("button");
          delBtn.textContent = "Elimina";
          delBtn.className = "btn-delete";
          delBtn.onclick = () => removeItem(type,i);
          btnGroup.appendChild(delBtn);

          const saveBtn = document.createElement("button");
          saveBtn.textContent = "Salva";
          saveBtn.className = "btn-save";
          saveBtn.onclick = () => {
            arr[i] = it;
            saveData(type, arr);
            alert("Modificato");
          };
          btnGroup.appendChild(saveBtn);

          row.appendChild(btnGroup);
          sec.appendChild(row);
        });
        container.appendChild(sec);
      });
    }

    function removeItem(type,index){
      if(!confirm("Eliminare elemento?"))return;
      const arr = getData(type);
      arr.splice(index,1);
      saveData(type,arr);
      loadEditLists();
      alert("Eliminato");
    }

    // ---- AGGIORNA DA GOOGLE SHEETS ----
    async function aggiornaDaGoogle() {
      const status = document.getElementById("updateStatus");
      status.textContent = "Caricamento in corso...";

      try {
        const url = "https://script.google.com/macros/s/AKfycbzO4CqL3--A9-HlhnEkp2qYX_U0kFsel4zOZGlTrdP1/dev"; // sostituisci con il tuo
        const keys = ["news", "giocatori", "sponsor", "partite", "calendario"];
        for (const key of keys) {
          const res = await fetch(url + key);
          const data = await res.json();
          saveData(key, data);
        }
        status.textContent = "✔️ Dati aggiornati con successo!";
        loadEditLists();
      } catch (e) {
        status.textContent = "❌ Errore durante l’aggiornamento.";
      }
    }
  </script>
</body>
</html>
