<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin - U.S. Corbiolo C5</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    body { padding-top: 80px; }
    #adminContent, .section-content { display: none; }
    .toggle-btn { width:100%; padding:12px; background:#801e1e; color:white; font-size:18px; border:none; text-align:left; cursor:pointer; margin-bottom:4px; }
    .section { background:#801e1e; padding:14px; border-radius:8px; margin-bottom:12px; }
    .section input, .section textarea, .section select { width:100%; margin-bottom:8px; padding:8px; border-radius:4px; border:none; }
    .section button { padding:10px 16px; margin-right:8px; border:none; border-radius:4px; background:#ffcc00; color:#000; cursor:pointer; }
    .item-row { display:flex; align-items:center; gap:4px; margin-bottom:6px; flex-wrap: wrap; }
    .item-row input, .item-row textarea { flex: 1; padding: 6px; margin-bottom: 4px; }
    .item-row button { background:#ff4444; color:white; padding:6px 10px; border:none; border-radius:4px; cursor:pointer; }
    #syncStatus { margin-top: 12px; padding: 10px; border-radius: 6px; font-weight: bold; text-align: center; }
  </style>
</head>
<body>
  <div id="passwordPrompt">
    <h2>Accesso Admin</h2>
    <input type="password" id="adminPass" placeholder="Inserisci password" />
    <button onclick="checkPassword()">Accedi</button>
  </div>

  <div id="adminContent">
    <header class="header">
      <img src="img/logo.png" alt="Logo" class="logo" />
      <h1 class="page-title">Admin</h1>
      <div class="menu-icon" onclick="toggleMenu()">☰</div>
    </header>

    <div class="popup-menu" id="popupMenu">
      <a href="index.html">🏠 Home</a>
      <a href="news.html">🗞️ News</a>
      <a href="squadra.html">👥 Squadra</a>
      <a href="partite.html">⚽️ Partite</a>
      <a href="calendario.html">🗓 Calendario</a>
      <a href="sponsor.html">💰 Sponsor</a>
      <a href="admin.html">🔐 Admin</a>
    </div>

    <button class="toggle-btn" onclick="toggleSection('insertContent')">➕ Inserimento Contenuti</button>
    <div id="insertContent" class="section-content">
      <div class="section">
        <h3>🗞️ Nuova News</h3>
        <input id="i_news_title" placeholder="Titolo" />
        <textarea id="i_news_text" placeholder="Contenuto"></textarea>
        <button onclick="insertItem('news')">Salva</button>
      </div>
      <div class="section">
        <h3>👤 Nuovo Giocatore</h3>
        <input id="i_player_name" placeholder="Nome" />
        <input id="i_player_role" placeholder="Ruolo" />
        <input id="i_player_number" placeholder="Numero" />
        <input id="i_player_photo" placeholder="Foto (es: nome.png)" />
        <button onclick="insertItem('giocatori')">Salva</button>
      </div>
      <div class="section">
        <h3>💼 Nuovo Sponsor</h3>
        <input id="i_sponsor_name" placeholder="Nome" />
        <input id="i_sponsor_logo" placeholder="Logo (es: logo.png)" />
        <input id="i_sponsor_link" placeholder="Link" />
        <button onclick="insertItem('sponsor')">Salva</button>
      </div>
      <div class="section">
        <h3>⚽ Nuova Partita</h3>
        <input type="date" id="i_match_date" />
        <input type="time" id="i_match_time" />
        <input id="i_match_home" placeholder="Casa" />
        <input id="i_match_home_logo" placeholder="Logo Casa" />
        <input id="i_match_away" placeholder="Fuori" />
        <input id="i_match_away_logo" placeholder="Logo Fuori" />
        <input id="i_match_score" placeholder="Risultato (es: 2-1)" />
        <button onclick="insertItem('partite')">Salva</button>
      </div>
      <div class="section">
        <h3>📅 Nuovo Evento Calendario</h3>
        <input type="date" id="i_cal_date" />
        <input id="i_cal_opponent" placeholder="Avversario" />
        <select id="i_cal_home"><option value="casa">Casa</option><option value="fuori">Fuori</option></select>
        <button onclick="insertItem('calendario')">Salva</button>
      </div>
    </div>

    <button class="toggle-btn" onclick="toggleSection('editContent')">✏️ Modifica/Elimina Contenuti</button>
    <div id="editContent" class="section-content">
      <div id="editLists"></div>
    </div>

    <!-- SEZIONE SYNC -->
    <div class="section">
      <h3>🔄 Sincronizza da Google Sheets</h3>
      <button onclick="syncFromGoogle()" style="background: #ffcc00;">Aggiorna dati da Google</button>
      <div id="syncStatus"></div>
    </div>
  </div>

  <script>
    const SHEETS_URL = "https://script.google.com/macros/s/AKfycby2micXUeoJcAb0zx-MncNXFMJLkf5BtPJdKcTkgzHXNHuSZIHr5ActFbcyKlt0OnJk/exec";

    function toggleMenu() {
      const m = document.getElementById("popupMenu");
      m.style.display = m.style.display === "flex" ? "none" : "flex";
    }

    function checkPassword() {
      if (document.getElementById("adminPass").value === "corb25") {
        document.getElementById("passwordPrompt").style.display = "none";
        document.getElementById("adminContent").style.display = "block";
        loadEditLists();
      } else alert("Password errata");
    }

    function toggleSection(id) {
      const el = document.getElementById(id);
      el.style.display = el.style.display === "block" ? "none" : "block";
    }

    function getData(key) {
      try { return JSON.parse(localStorage.getItem(key)) || [] } catch { return []; }
    }

    function saveData(key, arr) {
      localStorage.setItem(key, JSON.stringify(arr));
    }

    function insertItem(type) {
      const m = {
        news: ["i_news_title", "i_news_text"],
        giocatori: ["i_player_name", "i_player_role", "i_player_number", "i_player_photo"],
        sponsor: ["i_sponsor_name", "i_sponsor_logo", "i_sponsor_link"],
        partite: ["i_match_date", "i_match_time", "i_match_home", "i_match_home_logo", "i_match_away", "i_match_away_logo", "i_match_score"],
        calendario: ["i_cal_date", "i_cal_opponent", "i_cal_home"]
      };
      const ids = m[type];
      const obj = {};
      ids.forEach(id => obj[id.split('_').slice(1).join('_')] = document.getElementById(id).value.trim());
      const arr = getData(type);
      arr.unshift(obj);
      saveData(type, arr);
      alert(`${type} inserito`);
      ids.forEach(id => document.getElementById(id).value = "");
      loadEditLists();
    }

    function loadEditLists() {
      const container = document.getElementById("editLists");
      container.innerHTML = "";
      ["news", "giocatori", "sponsor", "partite", "calendario"].forEach(type => {
        const arr = getData(type);
        const sec = document.createElement("div");
        sec.className = "section";
        sec.innerHTML = `<h3>${type.toUpperCase()}</h3>`;
        arr.forEach((it, i) => {
          const row = document.createElement("div");
          row.className = "item-row";
          for (let key in it) {
            const input = document.createElement("input");
            input.value = it[key];
            input.oninput = e => it[key] = e.target.value;
            row.appendChild(input);
          }
          const delBtn = document.createElement("button");
          delBtn.textContent = "Elimina";
          delBtn.onclick = () => removeItem(type, i);
          row.appendChild(delBtn);
          const saveBtn = document.createElement("button");
          saveBtn.textContent = "Salva";
          saveBtn.style.background = "#33cc33";
          saveBtn.onclick = () => {
            arr[i] = it;
            saveData(type, arr);
            alert("Modificato");
          };
          row.appendChild(saveBtn);
          sec.appendChild(row);
        });
        container.appendChild(sec);
      });
    }

    function removeItem(type, index) {
      if (!confirm("Eliminare elemento?")) return;
      const arr = getData(type);
      arr.splice(index, 1);
      saveData(type, arr);
      loadEditLists();
      alert("Eliminato");
    }

    function syncFromGoogle() {
      const status = document.getElementById("syncStatus");
      status.innerHTML = "⏳ Caricamento in corso...";
      fetch(SHEETS_URL)
        .then(res => res.json())
        .then(data => {
          Object.entries(data).forEach(([key, val]) => saveData(key, val));
          status.style.background = "#33cc33";
          status.style.color = "white";
          status.innerHTML = "✅ Dati aggiornati correttamente!";
          loadEditLists();
        })
        .catch(err => {
          console.error(err);
          status.style.background = "#cc0000";
          status.style.color = "white";
          status.innerHTML = "❌ Errore nel caricamento dati.";
        });
    }
  </script>
  <script>
function aggiornaDati() {
  const messaggio = document.getElementById("aggiornaMessaggio");
  messaggio.textContent = "⏳ Aggiornamento in corso...";
  messaggio.style.color = "#fff";

  fetch("https://script.google.com/macros/s/AKfycby2micXUeoJcAb0zx-MncNXFMJLkf5BtPJdKcTkgzHXNHuSZIHr5ActFbcyKlt0OnJk/exec")
    .then(res => {
      if (!res.ok) throw new Error("Errore rete");
      return res.json();
    })
    .then(data => {
      localStorage.setItem("newsData", JSON.stringify(data.news));
      localStorage.setItem("partite", JSON.stringify(data.partite));
      localStorage.setItem("giocatori", JSON.stringify(data.giocatori));
      localStorage.setItem("sponsor", JSON.stringify(data.sponsor));
      localStorage.setItem("calendario", JSON.stringify(data.calendario));

      messaggio.textContent = "✅ Dati aggiornati con successo!";
      messaggio.style.color = "#00ff00";
    })
    .catch(err => {
      console.error("Errore aggiornamento:", err);
      messaggio.textContent = "❌ Errore nel caricamento dei dati.";
      messaggio.style.color = "#ff4444";
    });
}
</script>

</body>
</html>
